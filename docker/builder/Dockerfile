ARG DOCKER_HUB
ARG BUILDER_BASE
FROM ${DOCKER_HUB}/${BUILDER_BASE}

MAINTAINER Noroutine GmbH <info@noroutine.me>

ARG GIT_SERVER_HOST
ARG SSH_PRIVATE_KEY
ARG HOST_DOCKER_GID

ADD setup.sh /setup.sh
ADD setup.d /setup.d
ADD dotprofile/.bashrc /root/.bashrc

ENV GIT_SERVER_HOST=${GIT_SERVER_HOST}
ENV SSH_PRIVATE_KEY=${SSH_PRIVATE_KEY}

RUN /setup.sh

USER builder

ENV GIT_SERVER_HOST=${GIT_SERVER_HOST}
ENV SSH_PRIVATE_KEY=${SSH_PRIVATE_KEY}
ENV HOST_DOCKER_GID=${HOST_DOCKER_GID}

EXPOSE 3000
WORKDIR /home/builder

CMD [ "/usr/local/bin/ttyd", "-p", "3000", "/bin/bash"]